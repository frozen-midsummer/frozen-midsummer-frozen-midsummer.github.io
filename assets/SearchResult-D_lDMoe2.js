import{u as U,h as se,i as le,j as P,k as te,l as ae,t as ie,m as re,n as j,p as E,q as ue,w as Y,v as l,x as ne,R as I,y as oe,z as ce,A as ve,B as de,C as me,D as he,E as pe,G as ye,H as ge,I as fe,J as He,K as M,L as B,M as we,N as q,O as Re}from"./app-CSH33i_J.js";const ke=["/","/devtools/","/database/","/dotnet/","/htmlcss/","/javascript/","/os/","/python/","/serverside/","/websiteconstruction/","/devtools/git/","/devtools/littletools/","/devtools/markdown/","/devtools/maven/","/devtools/pnpm/","/devtools/superresolution/","/database/mysql/","/database/sql/","/javascript/projectconstruct/","/javascript/vuejs/","/os/linux/","/os/wine/","/serverside/designmodel/","/serverside/pythonlearning/README1.html","/serverside/regularexpression/","/websiteconstruction/githubpages/","/websiteconstruction/vuepresslearning/","/serverside/designmodel/dddlearning/","/serverside/designmodel/dddlearning/%E9%A2%86%E5%9F%9F%E9%A9%B1%E5%8A%A8%E8%AE%BE%E8%AE%A1.html","/serverside/designmodel/factorymodel/","/serverside/javalearning/mapstruct/","/serverside/javalearning/maven/","/serverside/javalearning/plantuml/","/404.html"],Ee="SLIMSEARCH_QUERY_HISTORY",y=U(Ee,[]),qe=()=>{const{queryHistoryCount:t}=q,a=t>0;return{enabled:a,queryHistories:y,addQueryHistory:i=>{a&&(y.value=Array.from(new Set([i,...y.value.slice(0,t-1)])))},removeQueryHistory:i=>{y.value=[...y.value.slice(0,i),...y.value.slice(i+1)]}}},$=t=>ke[t.id]+("anchor"in t?`#${t.anchor}`:""),xe="SLIMSEARCH_RESULT_HISTORY",{resultHistoryCount:O}=q,g=U(xe,[]),Qe=()=>{const t=O>0;return{enabled:t,resultHistories:g,addResultHistory:a=>{if(t){const i={link:$(a),display:a.display};"header"in a&&(i.header=a.header),g.value=[i,...g.value.slice(0,O-1)]}},removeResultHistory:a=>{g.value=[...g.value.slice(0,a),...g.value.slice(a+1)]}}},Ae=t=>{const a=de(),i=P(),x=me(),u=j(0),H=E(()=>u.value>0),h=he([]);return pe(()=>{const{search:p,terminate:Q}=ye(),f=we(o=>{const{resultsFilter:w=n=>n,querySplitter:D,suggestionsFilter:A,...b}=a.value;o?(u.value+=1,p(o,i.value,b).then(n=>w(n,o,i.value,x.value)).then(n=>{u.value-=1,h.value=n}).catch(n=>{console.warn(n),u.value-=1,u.value||(h.value=[])})):h.value=[]},q.searchDelay-q.suggestDelay,{maxWait:5e3});Y([t,i],([o])=>{f(o.join(" "))},{immediate:!0}),ge(()=>{Q()})}),{isSearching:H,results:h}};var Ce=se({name:"SearchResult",props:{queries:{type:Array,required:!0},isFocusing:Boolean},emits:["close","updateQuery"],setup(t,{emit:a}){const i=le(),x=P(),u=te(ae),{enabled:H,addQueryHistory:h,queryHistories:p,removeQueryHistory:Q}=qe(),{enabled:f,resultHistories:o,addResultHistory:w,removeResultHistory:D}=Qe(),A=H||f,b=ie(t,"queries"),{results:n,isSearching:_}=Ae(b),r=re({isQuery:!0,index:0}),d=j(0),m=j(0),F=E(()=>A&&(p.value.length>0||o.value.length>0)),C=E(()=>n.value.length>0),S=E(()=>n.value[d.value]||null),z=()=>{const{isQuery:e,index:s}=r;s===0?(r.isQuery=!e,r.index=e?o.value.length-1:p.value.length-1):r.index=s-1},G=()=>{const{isQuery:e,index:s}=r;s===(e?p.value.length-1:o.value.length-1)?(r.isQuery=!e,r.index=0):r.index=s+1},J=()=>{d.value=d.value>0?d.value-1:n.value.length-1,m.value=S.value.contents.length-1},K=()=>{d.value=d.value<n.value.length-1?d.value+1:0,m.value=0},N=()=>{m.value<S.value.contents.length-1?m.value+=1:K()},V=()=>{m.value>0?m.value-=1:J()},L=e=>e.map(s=>Re(s)?s:l(s[0],s[1])),W=e=>{if(e.type==="customField"){const s=fe[e.index]||"$content",[c,k=""]=He(s)?s[x.value].split("$content"):s.split("$content");return e.display.map(v=>l("div",L([c,...v,k])))}return e.display.map(s=>l("div",L(s)))},R=()=>{d.value=0,m.value=0,a("updateQuery",""),a("close")},X=()=>H?l("ul",{class:"slimsearch-result-list"},l("li",{class:"slimsearch-result-list-item"},[l("div",{class:"slimsearch-result-title"},u.value.queryHistory),p.value.map((e,s)=>l("div",{class:["slimsearch-result-item",{active:r.isQuery&&r.index===s}],onClick:()=>{a("updateQuery",e)}},[l(M,{class:"slimsearch-result-type"}),l("div",{class:"slimsearch-result-content"},e),l("button",{class:"slimsearch-remove-icon",innerHTML:B,onClick:c=>{c.preventDefault(),c.stopPropagation(),Q(s)}})]))])):null,Z=()=>f?l("ul",{class:"slimsearch-result-list"},l("li",{class:"slimsearch-result-list-item"},[l("div",{class:"slimsearch-result-title"},u.value.resultHistory),o.value.map((e,s)=>l(I,{to:e.link,class:["slimsearch-result-item",{active:!r.isQuery&&r.index===s}],onClick:()=>{R()}},()=>[l(M,{class:"slimsearch-result-type"}),l("div",{class:"slimsearch-result-content"},[e.header?l("div",{class:"content-header"},e.header):null,l("div",e.display.map(c=>L(c)).flat())]),l("button",{class:"slimsearch-remove-icon",innerHTML:B,onClick:c=>{c.preventDefault(),c.stopPropagation(),D(s)}})]))])):null;return ue("keydown",e=>{if(t.isFocusing){if(C.value){if(e.key==="ArrowUp")V();else if(e.key==="ArrowDown")N();else if(e.key==="Enter"){const s=S.value.contents[m.value];h(t.queries.join(" ")),w(s),i.push($(s)),R()}}else if(f){if(e.key==="ArrowUp")z();else if(e.key==="ArrowDown")G();else if(e.key==="Enter"){const{index:s}=r;r.isQuery?(a("updateQuery",p.value[s]),e.preventDefault()):(i.push(o.value[s].link),R())}}}}),Y([d,m],()=>{var e;(e=document.querySelector(".slimsearch-result-list-item.active .slimsearch-result-item.active"))==null||e.scrollIntoView(!1)},{flush:"post"}),()=>l("div",{class:["slimsearch-result-wrapper",{empty:t.queries.length?!C.value:!F.value}],id:"slimsearch-results"},t.queries.length?_.value?l(ne,{hint:u.value.searching}):C.value?l("ul",{class:"slimsearch-result-list"},n.value.map(({title:e,contents:s},c)=>{const k=d.value===c;return l("li",{class:["slimsearch-result-list-item",{active:k}]},[l("div",{class:"slimsearch-result-title"},e||u.value.defaultTitle),s.map((v,ee)=>{const T=k&&m.value===ee;return l(I,{to:$(v),class:["slimsearch-result-item",{active:T,"aria-selected":T}],onClick:()=>{h(t.queries.join(" ")),w(v),R()}},()=>[v.type==="text"?null:l(v.type==="title"?oe:v.type==="heading"?ce:ve,{class:"slimsearch-result-type"}),l("div",{class:"slimsearch-result-content"},[v.type==="text"&&v.header?l("div",{class:"content-header"},v.header):null,l("div",W(v))])])})])})):u.value.emptyResult:A?F.value?[X(),Z()]:u.value.emptyHistory:u.value.emptyResult)}});export{Ce as default};
